################################################################################
# CivicQ Backend Environment Configuration
################################################################################
# IMPORTANT: This is a template file. Copy this to .env and fill in your values.
#
# Quick Start:
#   1. Copy: cp .env.example .env
#   2. Generate SECRET_KEY: openssl rand -hex 32
#   3. Configure required services (see REQUIRED VARIABLES section)
#   4. Update URLs for production deployment
#
# Security Note: Never commit .env to version control!
################################################################################

# ============================================================================
# ENVIRONMENT & DEBUGGING
# ============================================================================
ENVIRONMENT=development
# Options: development, staging, production
# Controls features like debug mode, logging verbosity, error display

DEBUG=true
# Set to false in production for security

# ============================================================================
# SECURITY (REQUIRED)
# ============================================================================
SECRET_KEY=CHANGEME-generate-with-openssl-rand-hex-32
# Generate with: openssl rand -hex 32
# CRITICAL: Must be unique and secure in production!

ALGORITHM=HS256
# JWT signing algorithm - do not change unless you know what you're doing

ACCESS_TOKEN_EXPIRE_MINUTES=1440
# JWT access token lifetime (default: 24 hours)

REFRESH_TOKEN_EXPIRE_DAYS=7
# Refresh token lifetime (default: 7 days)

# ============================================================================
# CORS & ALLOWED ORIGINS (REQUIRED)
# ============================================================================
ALLOWED_ORIGINS=http://localhost:3000,http://localhost:8000
# Comma-separated list of allowed frontend origins
# Production example: https://civicq.com,https://www.civicq.com,https://app.civicq.com
# CRITICAL: Must match your frontend URLs exactly (including protocol and port)

# ============================================================================
# APPLICATION URLs (REQUIRED)
# ============================================================================
FRONTEND_URL=http://localhost:3000
# Full URL where your React frontend is hosted
# Used for: OAuth callbacks, email links, CORS validation
# Production example: https://app.civicq.com

BACKEND_URL=http://localhost:8000
# Full URL where your FastAPI backend is hosted
# Used for: OAuth redirect URIs, API documentation links
# Production example: https://api.civicq.com

# ============================================================================
# DATABASE (REQUIRED)
# ============================================================================
DATABASE_URL=postgresql://civicq:civicq@localhost:5432/civicq
# PostgreSQL connection string
# Format: postgresql://user:password@host:port/database
# Production: Use managed database (RDS, Cloud SQL, etc.) with strong credentials
# Docker: Use service name as host (e.g., postgresql://civicq:civicq@db:5432/civicq)

DATABASE_ECHO=false
# Set to true to log all SQL queries (useful for debugging, slow in production)

# ============================================================================
# REDIS (REQUIRED)
# ============================================================================
REDIS_URL=redis://localhost:6379/0
# Redis connection for caching and rate limiting
# Format: redis://[password@]host:port/db
# Production: Use managed Redis (ElastiCache, Cloud Memorystore, etc.)
# Docker: redis://redis:6379/0

# ============================================================================
# S3 / OBJECT STORAGE (REQUIRED for video features)
# ============================================================================
S3_BUCKET=civicq-media
# S3 bucket name for storing videos, images, documents
# Must be created before deployment

S3_REGION=us-west-2
# AWS region for S3 bucket

S3_ACCESS_KEY=your-access-key
# AWS IAM access key with S3 permissions
# Required permissions: s3:PutObject, s3:GetObject, s3:DeleteObject

S3_SECRET_KEY=your-secret-key
# AWS IAM secret key (keep secure!)

S3_ENDPOINT=
# Leave empty for AWS S3
# For S3-compatible services (MinIO, DigitalOcean Spaces, etc.):
#   - MinIO: http://localhost:9000
#   - DigitalOcean Spaces: https://nyc3.digitaloceanspaces.com
#   - Backblaze B2: https://s3.us-west-002.backblazeb2.com

# ============================================================================
# CDN (OPTIONAL)
# ============================================================================
CDN_URL=
# CloudFront or other CDN URL for serving media assets
# Example: https://d1234567890.cloudfront.net
# Leave empty to serve directly from S3

# ============================================================================
# VIDEO PROCESSING
# ============================================================================
MAX_VIDEO_DURATION_SECONDS=180
# Maximum video length (3 minutes)

VIDEO_TIME_LIMIT_COUNCIL=90
# Time limit for city council candidate videos (90 seconds)

VIDEO_TIME_LIMIT_MAYOR=120
# Time limit for mayor candidate videos (2 minutes)

VIDEO_TIME_LIMIT_MEASURE=180
# Time limit for ballot measure videos (3 minutes)

# ============================================================================
# TRANSCRIPTION SERVICE (OPTIONAL - for video transcripts)
# ============================================================================
TRANSCRIPTION_SERVICE=whisper
# Options: whisper, deepgram, assemblyai
# whisper = OpenAI Whisper (most accurate, requires OPENAI_API_KEY)

OPENAI_API_KEY=
# Required if TRANSCRIPTION_SERVICE=whisper
# Get from: https://platform.openai.com/api-keys

DEEPGRAM_API_KEY=
# Required if TRANSCRIPTION_SERVICE=deepgram
# Get from: https://console.deepgram.com/

ASSEMBLYAI_API_KEY=
# Required if TRANSCRIPTION_SERVICE=assemblyai
# Get from: https://www.assemblyai.com/dashboard/

# ============================================================================
# AI/LLM FEATURES (OPTIONAL - for question analysis)
# ============================================================================
ANTHROPIC_API_KEY=
# Required for AI-powered features (question quality scoring, duplicate detection)
# Get from: https://console.anthropic.com/

ANTHROPIC_MODEL=claude-sonnet-4-5-20250929
# Claude model to use for AI features

ENABLE_AI_FEATURES=true
# Set to false to disable all AI features

# ============================================================================
# EMBEDDINGS (for question similarity/clustering)
# ============================================================================
EMBEDDING_MODEL=sentence-transformers/all-MiniLM-L6-v2
# HuggingFace model for text embeddings
# This model runs locally and doesn't require an API key

SIMILARITY_THRESHOLD=0.85
# Similarity threshold for duplicate question detection (0.0-1.0)

# ============================================================================
# QUESTION RANKING & CLUSTERING
# ============================================================================
TOP_QUESTIONS_COUNT=100
# Maximum number of top questions to display

CLUSTER_MAX_QUESTIONS=5
# Maximum questions per semantic cluster

MINORITY_CONCERN_SLOTS=10
# Reserved slots for minority community concerns

# ============================================================================
# RATE LIMITING
# ============================================================================
RATE_LIMIT_QUESTIONS_PER_DAY=10
# Maximum questions a user can submit per day

RATE_LIMIT_VOTES_PER_HOUR=100
# Maximum votes a user can cast per hour

# ============================================================================
# USER VERIFICATION
# ============================================================================
VERIFICATION_METHOD=sms
# Options: sms, email, id_proofing
# sms = Phone verification via Twilio (recommended)

VERIFICATION_CODE_EXPIRE_MINUTES=15
# How long verification codes remain valid

# ============================================================================
# SMS SERVICE - TWILIO (REQUIRED if VERIFICATION_METHOD=sms)
# ============================================================================
TWILIO_ACCOUNT_SID=your-twilio-account-sid
# Get from: https://console.twilio.com/

TWILIO_AUTH_TOKEN=your-twilio-auth-token
# Get from: https://console.twilio.com/

TWILIO_PHONE_NUMBER=+1234567890
# Your Twilio phone number (must be verified)
# Format: +1234567890 (E.164 format with country code)

# ============================================================================
# EMAIL SERVICE - SMTP (REQUIRED for email verification/notifications)
# ============================================================================
SMTP_HOST=smtp.gmail.com
# SMTP server hostname
# Gmail: smtp.gmail.com
# Outlook: smtp-mail.outlook.com
# Custom SMTP: your-smtp-server.com

SMTP_PORT=587
# SMTP port (587 for TLS, 465 for SSL)

SMTP_USER=your-email@example.com
# SMTP username (usually your email address)

SMTP_PASSWORD=your-email-password
# SMTP password or app-specific password
# Gmail: Use app password (https://support.google.com/accounts/answer/185833)

EMAIL_FROM=noreply@civicq.org
# "From" address for outgoing emails
# Must match SMTP_USER or be authorized sender

# ============================================================================
# EMAIL SERVICE - SENDGRID (ALTERNATIVE - recommended for production)
# ============================================================================
SENDGRID_API_KEY=
# Get from: https://app.sendgrid.com/settings/api_keys
# If set, SendGrid will be used instead of SMTP

# ============================================================================
# OAuth - GOOGLE (OPTIONAL)
# ============================================================================
GOOGLE_CLIENT_ID=
# Get from: https://console.cloud.google.com/apis/credentials
# Setup instructions:
#   1. Create OAuth 2.0 Client ID
#   2. Add authorized redirect URI: http://localhost:8000/api/v1/auth/oauth/google/callback
#   3. Production: Update with your domain (e.g., https://api.civicq.com/api/v1/auth/oauth/google/callback)

GOOGLE_CLIENT_SECRET=
# OAuth client secret from Google Cloud Console

# ============================================================================
# OAuth - FACEBOOK (OPTIONAL)
# ============================================================================
FACEBOOK_CLIENT_ID=
# Get from: https://developers.facebook.com/apps/
# Setup instructions:
#   1. Create Facebook App
#   2. Add Facebook Login product
#   3. Add OAuth redirect URI: http://localhost:8000/api/v1/auth/oauth/facebook/callback
#   4. Production: Update with your domain

FACEBOOK_CLIENT_SECRET=
# OAuth app secret from Facebook Developers

# ============================================================================
# SESSION MANAGEMENT
# ============================================================================
SESSION_EXPIRE_SECONDS=86400
# Default session lifetime (24 hours)

REMEMBER_ME_EXPIRE_SECONDS=2592000
# "Remember Me" session lifetime (30 days)

# ============================================================================
# CONTENT MODERATION
# ============================================================================
AUTO_MODERATE=true
# Automatically flag toxic/inappropriate content

TOXICITY_THRESHOLD=0.7
# Toxicity score threshold for auto-flagging (0.0-1.0)

# ============================================================================
# LOGGING
# ============================================================================
LOG_LEVEL=INFO
# Options: DEBUG, INFO, WARNING, ERROR, CRITICAL
# Use INFO for production, DEBUG for development

# ============================================================================
# ERROR TRACKING - SENTRY (OPTIONAL - recommended for production)
# ============================================================================
SENTRY_DSN=
# Get from: https://sentry.io/
# Leave empty to disable error tracking

# ============================================================================
# CELERY (REQUIRED for background tasks)
# ============================================================================
CELERY_BROKER_URL=redis://localhost:6379/1
# Redis database for Celery task queue
# Use different DB number than REDIS_URL (e.g., /1 instead of /0)
# Docker: redis://redis:6379/1

CELERY_RESULT_BACKEND=redis://localhost:6379/1
# Redis database for Celery task results
# Usually same as CELERY_BROKER_URL

# ============================================================================
# FEATURE FLAGS
# ============================================================================
ENABLE_VIDEO_RECORDING=true
# Allow candidates to record video answers

ENABLE_REBUTTALS=true
# Allow candidates to post rebuttals to questions

ENABLE_SOURCE_ATTACHMENTS=true
# Allow users to attach sources to questions

ENABLE_VIEWPOINT_CLUSTERING=true
# Group similar questions using AI clustering

# ============================================================================
# EXTERNAL BALLOT DATA APIs (OPTIONAL)
# ============================================================================
GOOGLE_CIVIC_API_KEY=
# Google Civic Information API for importing ballot data
# Get from: https://developers.google.com/civic-information

VOTE_AMERICA_API_KEY=
# VoteAmerica API for voter registration data
# Get from: https://www.voteamerica.com/api/

BALLOTPEDIA_API_KEY=
# Ballotpedia API for candidate/measure information
# Get from: https://ballotpedia.org/API-documentation

################################################################################
# PRODUCTION DEPLOYMENT CHECKLIST
################################################################################
# Before deploying to production:
#
# [ ] Generate new SECRET_KEY (never use default!)
# [ ] Update ALLOWED_ORIGINS with production frontend URL
# [ ] Update FRONTEND_URL with production domain
# [ ] Update BACKEND_URL with production API domain
# [ ] Configure managed PostgreSQL database
# [ ] Configure managed Redis instance
# [ ] Set up S3 bucket with proper IAM permissions
# [ ] Configure CDN (CloudFront, Cloudflare, etc.)
# [ ] Set up SendGrid or SMTP for email
# [ ] Configure Twilio for SMS verification
# [ ] Add Sentry DSN for error tracking
# [ ] Set DEBUG=false
# [ ] Set ENVIRONMENT=production
# [ ] Set LOG_LEVEL=INFO or WARNING
# [ ] Update OAuth redirect URIs in Google/Facebook consoles
# [ ] Enable SSL/TLS (HTTPS) for all services
# [ ] Set up database backups
# [ ] Configure monitoring and alerts
# [ ] Review and test all security settings
################################################################################
